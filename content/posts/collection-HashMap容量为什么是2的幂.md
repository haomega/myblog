---
title: "HashMap 容量为什么是2的幂"
date: 2020-07-11T16:00:33+08:00
draft: false
---

## HashMap桶的容量

HashMap是散列表的实现，使用桶+链表的数据结构；

将元素散列在各个桶中，HashMap默认的负载因子是`0.75f`，这是一个对于空间和时间取舍上的一个值，当元素和桶的数量超过负载因子时，桶会进行扩容，但是桶的容量一直保持为2的幂：


* 在初始化HashMap时，桶的容量为2的幂；
* 当HashMap桶的容量不够进行扩容时，桶的容量也是2的幂;

## Why？

当我们put一个值到HashMap时，会有如下步骤：
1. 计算key的hashcode；
2. 依据key的hashcode决定存储位置，会对hashcode取余；
3. 将key-value放入桶。

在进行第2步时，HashMap不是使用`%`进行取余，而是`index = (n - 1) & hash`

可以这样理解：

当n为2的幂时，比如n=8，二进制表示为`1000`，所以（n-1）的二进制为`0111`，进行&操作时，能快速的丢弃除后三位的所有1
这样就不用取余计算了，我们知道取余计算是乘法运算，与位运算相比，位运算更加快速。
